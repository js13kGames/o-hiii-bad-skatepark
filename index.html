<!doctype html>
<head>
<title>O HIII BAD SKATEPARK</title>
<link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text x=%22-.1em%22 y=%22.9em%22 font-size=%2290%22>🛹</text></svg>">
<style>
@font-face{font-family: emoji; src: url(Twemoji.ttf)}
@font-face{font-family:i;src:local(impact),url(//xem.github.io/geoquiz2/i.ttf)}
* {
  -webkit-tap-highlight-color: transparent;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  -webkit-user-select: none; /* Safari */
  -ms-user-select: none; /* IE 10 and IE 11 */
  user-select: none; /* Standard syntax */
}
html, body { overflow: hidden }
body { background: #ccc; }
canvas { background: radial-gradient(circle at 400px 0px, #fff 50%,#ddd 80%); display: block; margin: calc(50vh - 300px) auto; cursor: pointer; box-shadow: 5px 5px 50px #888; border-radius: 10px; }
#buttons { position: absolute; top: 0; width: 800px; text-align: center; margin: calc(50vh - 285px) calc(50vw - 400px); }
button { background: #ddd; border: 2px solid #888; border-radius: 5px; font: bold 16px calibri; cursor: pointer; }
.hidden { display: none }
.active { background: #fff; }
</style>
</head>
<body>
<canvas id=c width=800 height=600></canvas>
<br>
<div id=buttons class=xhidden>
<button id=line class=active>LINE</button>
<button id=move>MOVE</button>
<button id=del>DELETE</button>
<button id=play>PLAY</button>
<button id=save>SAVE</button>
<button id=load>LOAD</button>
<button id=editor class=hidden>RETURN TO EDITOR</button>
</div>
<script>

// Helpers
lerp = (start, end, amt) => {
  if(amt > 1) amt = 1;
  return (1-amt)*start+amt*end
}

easeInOutQuad = (x) => {
  if(x > 1) x = 1;
  return x < 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2;
}

// Globals
state = 1; // 0: title, 1: editor, 2: play
action = "line" // or move or delete
mousedown = 0;
currentline = { x: 0, y: 0, x2: 0, y2: 0 };
lines = [];
x = c.getContext("2d");
x.fillStyle = "#000";
offsets1 = [20,60,110,140,187,240,290,320,370,410,460,510,555,605,655,705,735];
offset = 10;
title=["T","R","I","S","K","A","I","D","E","K","A","P","H","O","B","I","A"]
offsets2 = [515,682,130,380,425,475,155,315,555,730,270,590,80,20,220,180,635];
amt = 0;
letter = -4;
X = 0,
Y = 200;
amt2 = -450;
mousex = 0;
mousey = 0;

// Render / Game loop
I = setInterval(()=>{
  c.width ^= 0;
  x.save();
  if(state == 0){
    for(i in title){
      x.font = "90px i, impact, calibri, arial";
      x.fillStyle = "#000";
      if(i == letter){
        x.fillText(title[i], X=lerp(offsets1[i],offsets2[i],easeInOutQuad(amt)), Y=lerp(150,250,easeInOutQuad(amt)));
      }
      else if(i < letter){
        x.fillText(title[i], X=offsets2[i], Y=250);
      }
      else if(i > letter){
        x.fillText(title[i], X=offsets1[i], Y=150);
      }
      if(title[i] == "I") {
        x.fillStyle = "#fff";
        x.fillRect(X, Y - 60, 25, 5);
      }
    }
    if(amt >= 1){
      amt = 0;
      letter ++;
      y = 0;
    }
    amt += .1;
    amt2 += 4;
    x.font = "50px i, impact, calibri, arial";
    x.fillText("PLAY",350,530);

    if(amt2 < 1000){
      x.fillRect(0,155,amt2+250,5);
      x.font = "120px emoji";
      x.fillText("✏️",amt2+135,145);
      x.fillText("🕺️",amt2-30,110);
      x.font = "100px emoji";
      x.translate(amt2-40,130);
      x.rotate(.5);
      x.fillText("🛹",0,0);
      
    }
    else {
      x.fillRect(0,155,amt2+70,5);
      x.fillRect(2200-amt2-320,465,1200,5);
      x.translate(2200-amt2-40,440);
      x.scale(-1,1);
      x.font = "150px emoji";
      x.fillText("✏",140,10);
      x.fillText("🕺",10,-20);
      x.rotate(.5);
      x.font = "120px emoji";
      x.fillText("🛹",0,-5);
      amt2+=2;
    }
  
    if(amt2>2100 && !navigator.userAgent.includes("Firefox")){
      x.restore();
      for(i = 0; i < 90; i++){
        x.globalAlpha = ((100-(2200-amt2))/100/9/((100-i)/15));
        x.drawImage(c, 0, 160+i, 1000, 1, (-90+i)*2, 340-i, 1000+(90-i)*5, 1); 
        x.drawImage(c, 0, 470+i, 1000, 1, (-90+i)*2+40, 590-i, 1000+(70-i)*5, 1); 
      }
    }
    if(amt2>2200){
      amt2 = 2200;
      //clearInterval(I);
    }
  }
  
  else if(state == 1){
    x.fillRect(mousex, mousey, 5,5);
    x.lineWidth = 5;
    for(i of lines){
      x.moveTo(i.x, i.y);
      x.lineTo(i.x2, i.y2);
    }
    if(currentline.x2){
      x.moveTo(currentline.x, currentline.y);
      x.lineTo(currentline.x2, currentline.y2);
    }
    x.stroke();
  }

}, 16)

// Click
onclick = (e) => {
  if(state == 0 && e.target.id == "c"){
    state = 1;
    buttons.classList.remove("hidden");
  }
  else if(state == 1){
    //console.log(e.target.id);
    if(e.target.id == "line"){
      action = "line";
      line.classList.add("active");
      move.classList.remove("active");
      del.classList.remove("active");
      play.classList.remove("active");
    }
    else if(e.target.id == "move"){
      action = "move";
      line.classList.remove("active");
      move.classList.add("active");
      del.classList.remove("active");
      play.classList.remove("active");
    }
    else if(e.target.id == "del"){
      action = "delete";
      line.classList.remove("active");
      move.classList.remove("active");
      del.classList.add("active");
      play.classList.remove("active");
    }
    else if(e.target.id == "play"){
      action = "play";
      line.classList.add("hidden");
      move.classList.add("hidden");
      del.classList.add("hidden");
      play.classList.add("hidden");
      save.classList.add("hidden");
      load.classList.add("hidden");
      editor.classList.remove("hidden");
    }
    else if(e.target.id == "editor"){
      action = "editor";
      line.classList.remove("hidden");
      move.classList.remove("hidden");
      del.classList.remove("hidden");
      play.classList.remove("hidden");
      save.classList.remove("hidden");
      load.classList.remove("hidden");
      editor.classList.add("hidden");
    }
  }
}

// Mousemove
c.onmousemove = e => {
  mousex = e.offsetX;
  mousey = e.offsetY;
  if(mousedown){
    currentline.x2 = mousex;
    currentline.y2 = mousey;
  }
}

// Mousedown / up
c.onmousedown = e => {
  mousedown = 1;
  currentline.x = mousex;
  currentline.y = mousey;
}
c.onmouseup = e => {
  mousedown = 0;
  console.log(currentline);
  console.log((currentline.x + currentline.x2)/2);
  console.log((currentline.y + currentline.y2)/2);
  console.log(-Math.atan2(currentline.y2-currentline.y, currentline.x2-currentline.x));
  lines.push(currentline);
  currentline = {x: 0, y: 0 }
}

</script>
</body>
